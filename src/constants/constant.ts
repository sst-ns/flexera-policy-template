export const samplePGResponse = `ruby\nname \"AWS EC2 Instance Inventory\"\nrs_pt_ver 20180301\ntype \"policy\"\nshort_description \"Inventory of all EC2 instances with detailed information\"\nlong_description \"This policy provides a comprehensive inventory of all AWS EC2 instances, including details such as Instance ID, Name tag, Instance Type, State, Availability Zone, VPC ID, Subnet ID, Private/Public IPs, Security Groups, IAM Role, Launch Time, AMI ID, Platform, Key Pair, Root and Attached Volumes, and all Tags.\"\nseverity \"low\"\ncategory \"Inventory\"\ndefault_frequency \"daily\"\ninfo(\n  version: \"1.0\",\n  provider: \"AWS\",\n  service: \"EC2\",\n  policy_set: \"EC2 Inventory\"\n)\n\n###############################################################################\n# Parameters\n###############################################################################\n\nparameter \"param_email\" do\n  type \"list\"\n  category \"Policy Settings\"\n  label \"Email addresses to notify\"\n  description \"Email addresses of the recipients you wish to notify when new incidents are created\"\n  default []\nend\n\nparameter \"param_aws_account_number\" do\n  type \"string\"\n  category \"Policy Settings\"\n  label \"Account Number\"\n  description \"Leave blank; this is for automated use with Meta Policies. See README for more details.\"\n  default \"\"\nend\n\nparameter \"param_regions_allow_or_deny\" do\n  type \"string\"\n  category \"Filters\"\n  label \"Allow/Deny Regions\"\n  description \"Allow or Deny entered regions.\"\n  allowed_values \"Allow\", \"Deny\"\n  default \"Allow\"\nend\n\nparameter \"param_allowed_regions\" do\n  type \"list\"\n  category \"Filters\"\n  label \"Regions\"\n  description \"List of regions to Allow/Deny based on selection above. If empty, all regions will be interrogated.\"\n  default []\nend\n\n###############################################################################\n# Authentication\n###############################################################################\n\ncredentials \"auth_aws\" do\n  schemes \"aws\", \"aws_sts\"\n  label \"AWS\"\n  description \"Select the AWS Credential from the list\"\n  tags \"provider=aws\"\n  aws_account_number $param_aws_account_number\nend\n\n###############################################################################\n# Pagination\n###############################################################################\n\npagination \"pagination_aws_ec2_describeinstances_xml\" do\n  get_page_marker do\n    body_path \"//DescribeInstancesResponse/nextToken\"\n  end\n  set_page_marker do\n    query \"NextToken\"\n  end\nend\n\n###############################################################################\n# Datasources & Scripts\n###############################################################################\n\ndatasource \"ds_aws_account\" do\n  request do\n    auth $auth_aws\n    host \"sts.amazonaws.com\"\n    path \"/\"\n    query \"Action\", \"GetCallerIdentity\"\n    query \"Version\", \"2011-06-15\"\n    header \"User-Agent\", \"RS Policies\"\n  end\n  result do\n    encoding \"xml\"\n    field \"id\", xpath(response, \"//GetCallerIdentityResponse/GetCallerIdentityResult/Account\")\n    field \"account_name\", xpath(response, \"//GetCallerIdentityResponse/GetCallerIdentityResult/Arn\")\n  end\nend\n\ndatasource \"ds_regions_list\" do\n  request do\n    auth $auth_aws\n    host \"ec2.amazonaws.com\"\n    path \"/\"\n    query \"Action\", \"DescribeRegions\"\n    query \"Version\", \"2016-11-15\"\n    query \"Filter.1.Name\", \"opt-in-status\"\n    query \"Filter.1.Value.1\", \"opt-in-not-required\"\n    query \"Filter.1.Value.2\", \"opted-in\"\n  end\n  result do\n    encoding \"xml\"\n    collect xpath(response, \"//DescribeRegionsResponse/regionInfo/item\", \"array\") do\n      field \"region\", xpath(col_item, \"regionName\")\n    end\n  end\nend\n\nscript \"js_regions\", type: \"javascript\" do\n  parameters \"param_allowed_regions\", \"ds_regions_list\", \"param_regions_allow_or_deny\"\n  result \"result\"\n  code <<-EOS\n    result = [];\n    if (param_allowed_regions.length === 0) {\n      result = ds_regions_list;\n    } else {\n      for (var i = 0; i < ds_regions_list.length; i++) {\n        if (param_regions_allow_or_deny === 'Allow' && param_allowed_regions.indexOf(ds_regions_list[i]['region']) >= 0) {\n          result.push(ds_regions_list[i]);\n        } else if (param_regions_allow_or_deny === 'Deny' && param_allowed_regions.indexOf(ds_regions_list[i]['region']) === -1) {\n          result.push(ds_regions_list[i]);\n        }\n      }\n    }\n  EOS\nend\n\ndatasource \"ds_regions\" do\n  run_script $js_regions, $param_allowed_regions, $ds_regions_list, $param_regions_allow_or_deny\nend\n\ndatasource \"ds_instances\" do\n  iterate $ds_regions\n  request do\n    auth $auth_aws\n    pagination $pagination_aws_ec2_describeinstances_xml\n    host join(['ec2.', val(iter_item, 'region'), '.amazonaws.com'])\n    path '/'\n    header 'User-Agent', 'RS Policies'\n    header 'Content-Type', 'text/xml'\n    query 'Action', 'DescribeInstances'\n    query 'Version', '2016-11-15'\n    query 'MaxResults', '1000'\n    ignore_status [403]\n  end\n  result do\n    encoding \"xml\"\n    collect xpath(response, \"//DescribeInstancesResponse/reservationSet/item\", \"array\") do\n      field \"ownerId\", xpath(col_item, \"ownerId\")\n      field \"instances_set\" do\n        collect xpath(col_item, \"instancesSet/item\", \"array\") do\n          field \"architecture\", xpath(col_item, \"architecture\")\n          field \"blockDevices\" do\n            collect xpath(col_item, \"blockDeviceMapping/item\", \"array\") do\n              field \"deviceName\", xpath(col_item, \"deviceName\")\n              field \"volumeId\", xpath(col_item, \"ebs/volumeId\")\n              field \"status\", xpath(col_item, \"ebs/status\")\n              field \"attachTime\", xpath(col_item, \"ebs/attachTime\")\n              field \"deleteOnTermination\", xpath(col_item, \"ebs/deleteOnTermination\")\n            end\n          end\n          field \"imageId\", xpath(col_item, \"imageId\")\n          field \"instanceId\", xpath(col_item, \"instanceId\")\n          field \"instanceState\", xpath(col_item, \"instanceState/name\")\n          field \"instanceType\", xpath(col_item, \"instanceType\")\n          field \"keyName\", xpath(col_item, \"keyName\")\n          field \"launchTime\", xpath(col_item, \"launchTime\")\n          field \"monitoringState\", xpath(col_item, \"monitoring/state\")\n          field \"platformDetails\", xpath(col_item, \"platformDetails\")\n          field \"region\", val(iter_item, \"region\")\n          field \"rootDeviceName\", xpath(col_item, \"rootDeviceName\")\n          field \"rootDeviceType\", xpath(col_item, \"rootDeviceType\")\n          field \"securityGroups\" do\n            collect xpath(col_item, \"groupSet/item\", \"array\") do\n              field \"groupId\", xpath(col_item, \"groupId\")\n              field \"groupName\", xpath(col_item, \"groupName\")\n            end\n          end\n          field \"subnetId\", xpath(col_item, \"subnetId\")\n          field \"availabilityZone\", xpath(col_item, \"placement/availabilityZone\")\n          field \"placementGroupName\", xpath(col_item, \"placement/groupName\")\n          field \"tenancy\", xpath(col_item, \"placement/tenancy\")\n          field \"usageOperation\", xpath(col_item, \"usageOperation\")\n          field \"vpcId\", xpath(col_item, \"vpcId\")\n          field \"privateIpAddress\", xpath(col_item, \"privateIpAddress\")\n          field \"publicIpAddress\", xpath(col_item, \"ipAddress\")\n          field \"privateDnsName\", xpath(col_item, \"privateDnsName\")\n          field \"publicDnsName\", xpath(col_item, \"dnsName\")\n          field \"iamInstanceProfile\", xpath(col_item, \"iamInstanceProfile/arn\")\n          field \"tags\" do\n            collect xpath(col_item, \"tagSet/item\", \"array\") do\n              field \"key\", xpath(col_item, \"key\")\n              field \"value\", xpath(col_item, \"value\")\n            end\n          end\n        end\n      end\n    end\n  end\nend\n\ndatasource \"ds_formatted_instances\" do\n  run_script $js_format_instances, $ds_instances, $ds_aws_account\nend\n\nscript \"js_format_instances\", type: \"javascript\" do\n  parameters \"ds_instances\", \"ds_aws_account\"\n  result \"result\"\n  code <<-EOS\n    result = [];\n\n    for (var i = 0; i < ds_instances.length; i++) {\n      var reservation = ds_instances[i];\n      var instances = reservation['instances_set'];\n      \n      for (var j = 0; j < instances.length; j++) {\n        var instance = instances[j];\n        \n        // Extract name tag if present\n        var instanceName = \"\";\n        var tagList = [];\n        var formattedTags = [];\n        \n        if (instance['tags']) {\n          for (var k = 0; k < instance['tags'].length; k++) {\n            var tag = instance['tags'][k];\n            tagList.push(tag['key'] + \"=\" + tag['value']);\n            \n            // Save Name tag separately\n            if (tag['key'] === 'Name') {\n              instanceName = tag['value'];\n            }\n          }\n          formattedTags = tagList.join(\", \");\n        }\n        \n        // Format security groups\n        var securityGroups = [];\n        if (instance['securityGroups']) {\n          for (var s = 0; s < instance['securityGroups'].length; s++) {\n            var sg = instance['securityGroups'][s];\n            securityGroups.push(sg['groupId'] + \" (\" + sg['groupName'] + \")\");\n          }\n        }\n        \n        // Format block devices (volumes)\n        var volumes = [];\n        if (instance['blockDevices']) {\n          for (var v = 0; v < instance['blockDevices'].length; v++) {\n            var volume = instance['blockDevices'][v];\n            var isRoot = (volume['deviceName'] === instance['rootDeviceName']) ? \" (root)\" : \"\";\n            volumes.push(volume['volumeId'] + isRoot + \" (\" + volume['deviceName'] + \")\");\n          }\n        }\n        \n        result.push({\n          'accountId': ds_aws_account['id'],\n          'accountName': ds_aws_account['account_name'],\n          'region': instance['region'],\n          'instanceId': instance['instanceId'],\n          'instanceName': instanceName,\n          'instanceType': instance['instanceType'],\n          'instanceState': instance['instanceState'],\n          'availabilityZone': instance['availabilityZone'],\n          'vpcId': instance['vpcId'],\n          'subnetId': instance['subnetId'],\n          'privateIpAddress': instance['privateIpAddress'],\n          'publicIpAddress': instance['publicIpAddress'],\n          'privateDnsName': instance['privateDnsName'],\n          'publicDnsName': instance['publicDnsName'],\n          'securityGroups': securityGroups.join(\", \"),\n          'iamRole': instance['iamInstanceProfile'],\n          'keyPair': instance['keyName'],\n          'launchTime': instance['launchTime'],\n          'imageId': instance['imageId'],\n          'platformDetails': instance['platformDetails'],\n          'architecture': instance['architecture'],\n          'tenancy': instance['tenancy'],\n          'rootDeviceType': instance['rootDeviceType'],\n          'monitoringState': instance['monitoringState'],\n          'volumes': volumes.join(\", \"),\n          'tags': formattedTags\n        });\n      }\n    }\n  EOS\nend\n\n###############################################################################\n# Policy\n###############################################################################\n\npolicy \"pol_aws_ec2_instance_inventory\" do\n  validate_each $ds_formatted_instances do\n    summary_template \"AWS EC2 Instance Inventory\"\n    detail_template <<-EOS\n    EOS\n    check eq(0,1)\n    export do\n      resource_level true\n      field \"accountId\" do\n        label \"Account ID\"\n      end\n      field \"accountName\" do\n        label \"Account Name\"\n      end\n      field \"region\" do\n        label \"Region\"\n      end\n      field \"instanceId\" do\n        label \"Instance ID\"\n      end\n      field \"instanceName\" do\n        label \"Instance Name\"\n      end\n      field \"instanceType\" do\n        label \"Instance Type\"\n      end\n      field \"instanceState\" do\n        label \"Instance State\"\n      end\n      field \"availabilityZone\" do\n        label \"Availability Zone\"\n      end\n      field \"vpcId\" do\n        label \"VPC ID\"\n      end\n      field \"subnetId\" do\n        label \"Subnet ID\"\n      end\n      field \"privateIpAddress\" do\n        label \"Private IP Address\"\n      end\n      field \"publicIpAddress\" do\n        label \"Public IP Address\"\n      end\n      field \"privateDnsName\" do\n        label \"Private DNS Name\"\n      end\n      field \"publicDnsName\" do\n        label \"Public DNS Name\"\n      end\n      field \"securityGroups\" do\n        label \"Security Groups\"\n      end\n      field \"iamRole\" do\n        label \"IAM Role\"\n      end\n      field \"keyPair\" do\n        label \"Key Pair\"\n      end\n      field \"launchTime\" do\n        label \"Launch Time\"\n      end\n      field \"imageId\" do\n        label \"AMI ID\"\n      end\n      field \"platformDetails\" do\n        label \"Platform\"\n      end\n      field \"architecture\" do\n        label \"Architecture\"\n      end\n      field \"tenancy\" do\n        label \"Tenancy\"\n      end\n      field \"rootDeviceType\" do\n        label \"Root Device Type\"\n      end\n      field \"monitoringState\" do\n        label \"Monitoring State\"\n      end\n      field \"volumes\" do\n        label \"Volumes\"\n      end\n      field \"tags\" do\n        label \"Tags\"\n      end\n      field \"id\" do\n        label \"ID\"\n        path \"instanceId\"\n      end\n    end\n  end\nend\n\n###############################################################################\n# Escalations\n###############################################################################\n \nescalation \"esc_email\" do\n  automatic true\n  label \"Send Email\"\n  description \"Send incident email\"\n  email $param_email do\n    attach_export_table true\n  end\nend\n`;
